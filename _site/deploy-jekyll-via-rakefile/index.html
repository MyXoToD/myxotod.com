<!DOCTYPE html>
<html>
  <head>
    <title>Deploy Jekyll via Rakefile &raquo; Max Boll &ndash; Web-Developer &ndash; Speedcuber &ndash; MyXoToD.com</title>

    <!-- Meta -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width = device-width, initial-scale = 1.0, user-scalable = no">
    <meta name="description" content="Max Boll, Frontend and Backend Web-Developer from Mayence" />
    <meta name="keywords" content="MyXoToD, Max Boll, programming, webdesign, html5, css3, sass, scss, frontend, backend" />
    <link rel="author" href="/humans.txt" />

    <!-- Stylesheets -->
    <link type="text/css" rel="stylesheet" media="all" href="/assets/stylesheets/application.css" />
    <link type="text/css" rel="stylesheet" media="all" href="/assets/stylesheets/syntax.css" />
    <link type="text/css" rel="stylesheet" media="all" href="/assets/stylesheets/colors.css" />
    <link type="text/css" rel="stylesheet" media="all" href="/assets/stylesheets/media-queries.css" />

    <!-- Javascripts -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="/assets/javascripts/application.js"></script>
  </head>
  <body class="red">
  <section class="mobile-nav">
  <nav>
    <ul>
      <li>
        <a href="/">Stream</a>
      </li>
      <li>
        <a href="/about/">About</a>
      </li>
      <li>
        <a href="/lab/">Lab</a>
      </li>
      <li>
        <a href="/imprint/">Imprint</a>
      </li>
    </ul>
  </nav>
</section>

<section class="page">
  <div class="toggle-mobile-nav entypo-menu"></div>
  <aside class="left-col">
    <a class="avatar" href="/">
      
    </a>
    <div class="about">
      Hello, my name is Max, I am a frontend &amp; backend web-developer from Mayence.
    </div>
    <nav>
      <ul>
        <li>
          <a href="/">Stream</a>
        </li>
        <li>
          <a href="/about/">About</a>
        </li>
        <li>
          <a href="/lab/">Lab</a>
        </li>
      </ul>
    </nav>
    <div class="phrases hide-landscape">
      
    </div>
  </aside>
  <div class="right-col">
    <div class="content">
      <article>
        <header>
          <h1>Deploy Jekyll via Rakefile</h1>
        </header>
        <main>
          <p>Your website is built of Jekyll? Your server doesn&#39;t support Ruby? Therefore you can&#39;t host you site? Well, exactly this was my case. I found a gem called <a href="https://github.com/capistrano/capistrano">Capistrano</a>, which is for website deployment but this thing seemed just too big for my needs. Anyway, I managed to push this Jekyll website on my server with just a single command. This is how I did it.</p>

<h2>The Rakefile</h2>

<p>First you need to create a <em>Rakefile</em> in the root directory of your Jekyll site. So add a new file and name it &quot;Rakefile&quot;. Voilá, first step done.</p>

<h2>The Rake Tasks</h2>

<p>Now we need to feed the rakefile with two tasks. In this case a task is just a method which will be executed by the rakefile. The first task is going to be the <em>build</em>-task, it&#39;ll generate a stable build of your Jekyll source files into the &quot;_site&quot;-folder (by Jekyll defaults). The second task will connect to our server via SSH and synchronize our local files with the files on the server. Let&#39;s go then, open your rakefile:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:deploy</span><span class="o">]</span>

<span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="c1"># Build website</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:deploy</span> <span class="o">=&gt;</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="c1"># Upload files</span>
<span class="k">end</span>
</code></pre></div>

<p>Alright, now we have our two tasks and another line. The first line is to make sure that the <em>deploy</em>-task is the default task. For example: If we wanna call a rake task via console, we need to use this command <tt>$ rake deploy</tt>. With that first line the deploy task is the default, so we can just call <tt>$ rake</tt> to start.</p>

<p>Maybe you noticed another thing. The <em>deploy</em>-task is already different than the <em>build</em>-task. Why? This <tt>task :deploy =&gt; :build do</tt> means, that the <em>build</em>-task is called right before the <em>deploy</em>-task. Makes sense eh? Let&#39;s go on.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:deploy</span><span class="o">]</span>

<span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;jekyll build&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:deploy</span> <span class="o">=&gt;</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="c1"># Upload files</span>
<span class="k">end</span>
</code></pre></div>

<p>To generate our Jekyll build, this will do the trick: <tt>system(&quot;jekyll build&quot;)</tt>. It will just fire a system command, the same as we would do it manually. I guess I don&#39;t need to explain that further. </p>

<div class="highlight"><pre><code class="ruby"><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:deploy</span><span class="o">]</span>

<span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;jekyll build&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:deploy</span> <span class="o">=&gt;</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="no">HOST</span> <span class="o">=</span> <span class="s2">&quot;example.com&quot;</span>
  <span class="no">USER</span> <span class="o">=</span> <span class="s2">&quot;john-doe&quot;</span>
  <span class="no">REMOTE</span> <span class="o">=</span> <span class="s2">&quot;/www/htdocs/foo/bar&quot;</span>
  <span class="no">LOCAL</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/_site/&quot;</span>
<span class="k">end</span>
</code></pre></div>

<p>To make things easier I made some variables with the data we need to continue.</p>

<ul>
<li><tt>HOST</tt> =&gt; Remote server host</li>
<li><tt>USER</tt> =&gt; Remote server username</li>
<li><tt>REMOTE</tt> =&gt; The absolute path to the destination on your remote server</li>
<li><tt>LOCAL</tt> =&gt; The absolute path to your local &quot;_site&quot;-folder of Jekyll (automatically generated)</li>
</ul>

<div class="highlight"><pre><code class="ruby"><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:deploy</span><span class="o">]</span>

<span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;jekyll build&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:deploy</span> <span class="o">=&gt;</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="no">HOST</span> <span class="o">=</span> <span class="s2">&quot;example.com&quot;</span>
  <span class="no">USER</span> <span class="o">=</span> <span class="s2">&quot;john-doe&quot;</span>
  <span class="no">REMOTE</span> <span class="o">=</span> <span class="s2">&quot;/www/htdocs/foo/bar&quot;</span>
  <span class="no">LOCAL</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/_site/&quot;</span>

  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;rsync -avz --delete </span><span class="si">#{</span><span class="no">LOCAL</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="no">USER</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="no">HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">REMOTE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

<p>Last but not least we need the <tt>rsync</tt>-command. This will connect to <tt>HOST</tt> with <tt>USER</tt> via SSH and synchronize the folders/files between the <tt>LOCAL</tt>- and <tt>REMOTE</tt>-directory. As soon as <tt>rsync</tt> is called, a password prompt appears. Type in the SSH password and hit return to run the script. Voilá your site is online. There are also some options: Option <strong>-a</strong> means archive mode. Option <strong>-v</strong> means &quot;verbose&quot;, it gives me some feedback while uploading files. Option <strong>-z</strong> means &quot;Compress file data during the transfer&quot;.</p>

<p>Navigate to your Jekyll&#39;s root folder via console and type <tt>$ rake</tt> to start the tasks. To get a little bit more output I updated the script like this:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:deploy</span><span class="o">]</span>

<span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;Generating current Jekyll build...&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;jekyll build&quot;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;Build ready.&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
<span class="k">end</span>

<span class="n">task</span> <span class="ss">:deploy</span> <span class="o">=&gt;</span> <span class="ss">:build</span> <span class="k">do</span>
  <span class="no">HOST</span> <span class="o">=</span> <span class="s2">&quot;example.com&quot;</span>
  <span class="no">USER</span> <span class="o">=</span> <span class="s2">&quot;john-doe&quot;</span>
  <span class="no">REMOTE</span> <span class="o">=</span> <span class="s2">&quot;/www/htdocs/foo/bar&quot;</span>
  <span class="no">LOCAL</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="si">}</span><span class="s2">/_site/&quot;</span>

  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;Connecting to &#39;</span><span class="si">#{</span><span class="no">HOST</span><span class="si">}</span><span class="s2">&#39; via SSH...&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;Please enter the remote password to start file transfer.&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;rsync -avz --delete </span><span class="si">#{</span><span class="no">LOCAL</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="no">USER</span><span class="si">}</span><span class="s2">@</span><span class="si">#{</span><span class="no">HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">REMOTE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;File tranfer complete.&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;Website is now live: </span><span class="si">#{</span><span class="no">HOST</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot;----------&quot;</span>
<span class="k">end</span>
</code></pre></div>

<p>See this code on <a href="https://github.com/MyXoToD/myxotod.com/blob/master/Rakefile">Github</a>.</p>

        </main>
        <footer>
          <div class="info">25 November 2013 &ndash; coding</div>
          <div class="reading-time">
            14 min &ndash; 679 words
          </div>
        </footer>
      </article>
    </div>
    <footer>
      Handcrafted with <span class="entypo-heart"></span> by Max Boll &ndash; 
      Powered by <a href="http://www.jekyllrb.com" target="_blank">Jekyll</a> &ndash; 
      Happy Wednesday &ndash; 
      <a href="/rss.xml">RSS</a> &ndash; 
      <a href="/imprint/">Imprint</a>
    </footer>
    <div class="to-top entypo-up-bold"></div>
  </div>
</section>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-10077192-4']);
      _gaq.push(['_setDomainName', 'myxotod.de']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_gat._anonymizeIp']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>